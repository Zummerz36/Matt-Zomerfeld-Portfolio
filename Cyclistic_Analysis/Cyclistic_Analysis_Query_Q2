-- -- calculate the average difference between "start_time" and "end_time" in Cyclistic_Annual_Clean. present results in hh:mm:ss format
SELECT
  FORMAT_TIME( '%H:%M:%S', TIME( TIMESTAMP_SECONDS( CAST(AVG(TIMESTAMP_DIFF(end_time, start_time, SECOND)) AS INT64)))) AS average_difference
FROM
  `cyclistic-case-study-466019.Cyclystic_User_Data_Clean.Cyclistic_Q2_Clean`;



-- Calculate maximum ride_time
SELECT
  MAX(ride_time) AS max_ride_time
FROM
  `cyclistic-case-study-466019.Cyclystic_User_Data_Clean.Cyclistic_Q2_Clean`;



-- calculate the mode of "ride_time" in Cyclistic_Annual_Clean
SELECT
  ride_time
FROM
  `cyclistic-case-study-466019.Cyclystic_User_Data_Clean.Cyclistic_Q2_Clean`
GROUP BY
  ride_time
ORDER BY
  COUNT(ride_time) DESC
LIMIT
  1;

-- calculate the average "ride_time" for each week day
SELECT
  weekday,
  FORMAT_TIME( '%H:%M:%S', TIME_ADD( TIME '00:00:00', INTERVAL CAST(AVG(TIMESTAMP_DIFF(end_time, start_time, SECOND)) AS INT64) SECOND)) AS average_ride_duration
FROM
  `cyclistic-case-study-466019.Cyclystic_User_Data_Clean.Cyclistic_Q2_Clean`
GROUP BY
  weekday
ORDER BY
  weekday;

-- calculate average number of "ride_id" for each hour of the day
SELECT
  EXTRACT(HOUR
  FROM
    start_time) AS hour_of_day,
  CAST(COUNT(trip_id) AS FLOAT64) / COUNT(DISTINCT DATE(start_time)) AS average_rides_per_day_in_hour
FROM
  `cyclistic-case-study-466019.Cyclystic_User_Data_Clean.Cyclistic_Q2_Clean`
GROUP BY
  hour_of_day
ORDER BY
  hour_of_day;



-- calculate the average, maximum, and mode "ride_time" of rows marked "Customer" and "Subscriber" in Cyclistic_Q2_Clean
SELECT
  user_type,
  FORMAT_TIME( '%H:%M:%S', TIME_ADD( TIME '00:00:00', INTERVAL CAST(AVG(ride_time_seconds) AS INT64) SECOND)) AS average_ride_time,
  FORMAT_TIME( '%H:%M:%S', TIME_ADD( TIME '00:00:00', INTERVAL CAST(MAX(ride_time_seconds) AS INT64) SECOND)) AS maximum_ride_time,
  ARRAY_AGG(ride_time
  ORDER BY
    ride_time_count DESC
  LIMIT
    1)[
OFFSET
  (0)] AS mode_ride_time
FROM (
  SELECT
    user_type,
    ride_time,
    CAST(SPLIT(ride_time, ':')[
    OFFSET
      (0)] AS INT64) * 3600 + CAST(SPLIT(ride_time, ':')[
    OFFSET
      (1)] AS INT64) * 60 + CAST(SPLIT(ride_time, ':')[
    OFFSET
      (2)] AS INT64) AS ride_time_seconds,
    COUNT(*) AS ride_time_count
  FROM
    `cyclistic-case-study-466019`.`Cyclystic_User_Data_Clean`.`Cyclistic_Q2_Clean`
  WHERE
    user_type IN ('Customer',
      'Subscriber')
  GROUP BY
    user_type,
    ride_time )
GROUP BY
  user_type;



-- show all columns of Cyclistic_Q2_Clean
SELECT
  *
FROM
  `cyclistic-case-study-466019`.`Cyclystic_User_Data_Clean`.`Cyclistic_Q2_Clean`;



-- show all rows with a "ride_time" over 12 hours in "Cyclistic_Q2_Clean"
SELECT
  trip_id,
  weekday,
  start_time,
  end_time,
  bikeid,
  ride_time,
  from_station_id,
  from_station_name,
  to_station_id,
  to_station_name,
  user_type
FROM
  `cyclistic-case-study-466019`.`Cyclystic_User_Data_Clean`.`Cyclistic_Q2_Clean`
WHERE
  CAST(SUBSTR(ride_time, 1, 2) AS INT64) >= 12
  AND CAST(SUBSTR(ride_time, 1, 2) AS INT64) > 12
  OR ( CAST(SUBSTR(ride_time, 1, 2) AS INT64) = 12
    AND ( CAST(SUBSTR(ride_time, 4, 2) AS INT64) > 0
      OR CAST(SUBSTR(ride_time, 7, 2) AS INT64) > 0));
